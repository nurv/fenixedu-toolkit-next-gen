{"version":3,"sources":["../../../../src/js/toolkit/ui/widgets.js"],"names":[],"mappings":"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","file":"widgets.js","sourcesContent":["import { closest } from \"toolkit/utils\";\n\nexport class InputWidget extends HTMLInputElement {\n  onsubmit(){}\n  onchange(){}\n}\n\nexport function UIRegister(name,extds){\n  return function (target, property, descriptor) {\n    var opts = {\n      prototype: Object.create(target.prototype)\n    }\n    opts['extends'] = extds;\n    document.registerElement(name, opts);\n    return target;\n  };\n}\n\nexport function UIOn(code, query){\n  return function(target, property, descriptor){\n    target._eventHandlers = target._eventHandlers || {};\n    target._eventHandlers[target.constructor.name] = target._eventHandlers[target.constructor.name] || []\n    target._eventHandlers[target.constructor.name].push({code:code, name:property, query:query})\n    return descriptor;\n  };\n}\n\nexport function UIOutlet(query){\n  return function(target, property, descriptor) {\n    target._outlets = target._outlets || {};\n    target._outlets[target.constructor.name] = target._outlets[target.constructor.name] || []\n    target._outlets[target.constructor.name].push({name:property, query:query});\n    descriptor.initializer = null;\n    return descriptor;\n  };\n}\n\nexport function UIAttribute(name){\n  return function(target, property, descriptor) {\n    delete descriptor.initializer;\n    delete descriptor.writable;\n\n    descriptor.get = function(){\n      return this.getAttribute(name);\n    }\n\n    descriptor.set = function(v){\n      this.setAttribute(name,v);\n    }\n\n    return descriptor;\n  };\n}\n\nexport function UIView(target, property, descriptor){\n\n  target.prototype.recalculateOutlets = function(){\n    console.log(target.prototype.constructor.name);\n    if (target.prototype._outlets[target.prototype.constructor.name] && target.prototype._outlets[target.prototype.constructor.name].length){\n      var that = this;\n      target.prototype._outlets[target.prototype.constructor.name].forEach(function(x){\n        Object.defineProperty(that, x.name, {\n          enumerable:true,\n          configurable:false,\n          get:() => that.view.querySelector(x.query),\n        });\n      })\n    }\n  }\n\n  target.prototype.attachEvtHandlers = function(){\n    if (target.prototype._eventHandlers[target.prototype.constructor.name] && target.prototype._eventHandlers[target.prototype.constructor.name].length){\n      var that = this;\n      target.prototype._eventHandlers[target.prototype.constructor.name].forEach(function(x){\n        let element = x.query? that.view.querySelector(x.query) : that.view;\n        element.addEventListener(x.code, (evt)=>that[x.name](evt))  \n      });\n    }\n  }\n\n  target.prototype.createdCallback = function() {\n    this.setAttribute(\"style\", \"display:none;\");\n    let render = this.render(); \n    this.view = document.createElement(\"div\")\n    this.view.className += \"fenixedu-toolkit-sd\";\n    if(typeof render === \"string\"){\n      this.view.innerHTML = render;\n    }else if (HTMLElement.prototype.isPrototypeOf(render)){\n      this.view.appendChild(render);\n    }else{\n      throw new Error (\"I don't know how to attach \" + render.toString());\n    }\n\n    this.parentNode.insertBefore(this.view, this.nextSibling);\n    this.recalculateOutlets();\n    this.attachEvtHandlers();\n\n    var element = closest(this, \"form\");\n\n    if(element){\n      element.addEventListener(\"submit\", x => this.onsubmit(x));\n    }\n\n    this.addEventListener(\"DOMSubtreeModified\", x => this.onchange(x), false);\n  }\n\n  return target;\n}"]}