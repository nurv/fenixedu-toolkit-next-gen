{"version":3,"sources":["../../../../src/js/toolkit/ui/localizedString.js"],"names":[],"mappings":"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","file":"localizedString.js","sourcesContent":["import { InputWidget, UIRegister, UIOutlet, UIView, UIAttribute, UIOn } from \"toolkit/ui/widgets\";\nimport { avaibleLocales, currentLocale, getLocale } from \"toolkit/locales\";\nimport { Observe } from \"toolkit/observers\";\n\nfunction getSingleTag(locale){\n  return locale.tag.split(\"-\")[0].toUpperCase();\n}\n\n@UIView\nclass LocalizedStringWidget extends InputWidget{\n  \n  @UIOutlet(\".fenixedu-toolkit-localized-string-menu\") menu;\n  @UIOutlet(\".fenixedu-toolkit-localized-string-button-long\") longButton;\n  @UIOutlet(\".fenixedu-toolkit-localized-string-button-short\") shortButton;\n\n  @UIOutlet(\".fenixedu-toolkit-localized-string-language\") language;\n  @UIOutlet(\".fenixedu-toolkit-localized-string-tag\") tag;\n\n  @UIAttribute(\"name\") name;\n  @UIAttribute(\"locale\") locale;\n\n  update() {\n    var localeObj = getLocale(this.locale);\n    var val = this.value;\n\n    if (val === \"\") {\n        this.value = \"{}\"\n        val = \"{}\";\n    }\n\n    var val = JSON.parse(val)\n    var tag = localeObj.tag;\n    \n    if (!(tag in val)){\n        var singleTag = getSingleTag(localeObj).toLowerCase();\n        if (singleTag in val){\n            tag = singleTag;\n        }\n    }\n\n    val = val[tag]\n    if (val !== this.presentationValue){\n        this.presentationValue = val || \"\";\n        this.language.innerHTML = localeObj.displayName\n        this.tag.innerHTML = localeObj.tag;\n    }\n  }\n\n  makeMenu(callback) {\n    for (var i = 0; i < avaibleLocales.length; i++) {\n      let locale = avaibleLocales[i];\n      let menuOption = document.createElement(\"li\");\n      let a = document.createElement(\"a\");\n      a.setAttribute(\"href\",\"#\");\n      a.setAttribute(\"onclick\",\"return false;\");\n      a.innerHTML = (locale.displayName || locale.tag);\n      menuOption.appendChild(a)\n\n\n      a.setAttribute(\"data-locale\",locale.tag);\n      \n      menuOption.addEventListener(\"click\", (x) => this.locale = x.target.getAttribute(\"data-locale\"));\n      this.menu.appendChild(menuOption);\n    }\n  }\n\n  @UIOn(\"input\", \".form-control\")\n  @UIOn(\"propertychange\", \".form-control\")\n  change(evt){\n    var data = JSON.parse(this.value);\n\n    var locale = getLocale(this.locale);\n    var tag = locale.tag\n\n    if (!(tag in data)){\n        var singleTag = getSingleTag(locale).toLowerCase();\n        if (singleTag in data){\n            tag = singleTag;\n        }\n    }\n\n    data[tag] = this.presentationValue;\n    this.value = JSON.stringify(data);\n    let event = new CustomEvent(\"change\", { \"target\": this, cancelable:false, bubbles:false, type: \"change\" });\n    document.dispatchEvent(event);\n  }\n \n  get disabled(){\n    return this._disabled;\n  }\n\n  set disabled(value){\n    this._disabled = value;\n  }\n\n  attachedCallback(){\n    this._disabled = false;\n    this.makeMenu();\n    this.recalculateButtons();\n    this.addEventListener(\"resize\", () => this.recalculateButtons());\n\n    this.onchange = function(){\n      this.update();\n    }\n\n    this.locale = currentLocale.tag;\n\n    Observe.element(this,{\n      attributes: true\n    },(mutations) => {\n      if(mutations){\n        if (mutations.filter((x) => x.type == \"attributes\" && x.attributeName == \"locale\").length > 0){\n          this.update();\n        }\n      }\n    });\n  }\n\n  get locale(){\n    return this.getAttribute(\"locale\");\n  }\n\n  set locale(value){\n    if (value == \"string\"){\n      value = getLocale(value);  \n    }\n    this.setAttribute(\"locale\", value.tag);\n    \n    this._localeObject = value;\n    this.view.querySelector(\".fenixedu-toolkit-localized-string-language\").innerHTML = value.displayName || getSingleTag(value);\n  }\n\n  setTagButton(locale, tagButton){\n      if(tagButton && tagButton.length) { tagButton.html(getSingleTag(locale)) };\n  }\n\n  recalculateButtons() { \n      let el = this.view.querySelectorAll(\".fenixedu-toolkit-localized-string-input-group\");\n      for (var i = 0; i < el.length; i++) {\n        let e = el[i]\n        var z = e.querySelector(\".fenixedu-toolkit-localized-string-button-long\");\n        var x = e.querySelector(\".fenixedu-toolkit-localized-string-button-short\");\n        if(x && z){\n          if ((z.offsetWidth / e.offsetWidth) > 1/3){\n              if (z.style.display !== \"none\"){\n                  x.style.display = \"inline\";\n                  z.style.display = \"none\";\n              }\n          }else{\n              if (x.style.display !== \"none\"){\n                  z.style.display = \"inline\";\n                  x.style.display = \"none\";\n              }\n          }\n        }\n      }\n  }\n}\n\n@UIRegister(\"ls-input\",\"input\")\nexport class InputLocalizedStringWidget extends LocalizedStringWidget{\n\n  @UIOutlet(\".fenixedu-toolkit-localized-string-input\") inputElement;\n\n  get presentationValue(){\n    return this.inputElement.value;\n  }\n\n  set presentationValue(v){\n    this.inputElement.value = v;\n  }\n\n  render(){\n    return `<div class=\"fenixedu-toolkit-localized-string-input-group\" >\n    <div class=\"input-group\">\n      <input type=\"text\" class=\"form-control fenixedu-toolkit-localized-string-input\">\n      <div class=\"input-group-btn fenixedu-toolkit-localized-string-group dropdown\">\n        <button type=\"button\" class=\" btn btn-default dropdown-toggle fenixedu-toolkit-localized-string-button-long fenixedu-toolkit-localized-string-button\" data-toggle=\"dropdown\">\n          <span class=\"fenixedu-toolkit-localized-string-language\"></span> \n          <span class=\"caret\"></span>\n        </button>\n        <button type=\"button\" class=\" btn btn-default dropdown-toggle fenixedu-toolkit-localized-string-button-short fenixedu-toolkit-localized-string-button\" data-toggle=\"dropdown\">\n          <span class=\"fenixedu-toolkit-localized-string-tag\"></span>\n          <span class=\"caret\"></span>\n        </button>\n        <ul class=\"dropdown-menu fenixedu-toolkit-localized-string-menu pull-right\" role=\"menu\"></ul>\n      </div>\n    </div>\n    <p class=\"help-block\"></p>\n  </div>`\n  }\n}\n\n@UIRegister(\"ls-textarea\", \"textarea\")\nexport class TextAreaLocalizedStringWidget extends LocalizedStringWidget{\n\n  @UIOutlet(\"fenixedu-toolkit-localized-string-textarea\") inputElement;\n\n  get presentationValue(){\n    return this.inputElement.value;\n  }\n\n  set presentationValue(v){\n    this.inputElement.value = v;\n  }\n\n  render(){\n    return `<div class=\"fenixedu-toolkit-localized-string-textArea\">\n    <p>\n      <div class=\"btn-group fenixedu-toolkit-localized-string-group\">\n        <button type=\"button\" class=\"btn btn-default dropdown-toggle fenixedu-toolkit-localized-string-button\" data-toggle=\"dropdown\">\n          <span class=\"fenixedu-toolkit-localized-string-language\"></span>\n          <span class=\"caret\"></span>\n        </button>\n\n        <ul class=\"dropdown-menu fenixedu-toolkit-localized-string-menu\" role=\"menu\"></ul>\n      </div>\n    </p>\n    <p>\n      <textarea class=\"form-control fenixedu-toolkit-localized-string-textarea\"></textarea>\n      <p class=\"help-block\">\n    </p>\n  </div>`;\n  }\n}\n"]}